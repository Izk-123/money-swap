{% extends 'swap_app/base.html' %}
{% load crispy_forms_tags %}

{% block title %}Create Swap - MoneySwap{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card swap-card">
            <div class="card-header">
                <h2 class="card-title mb-0">
                    <i class="bi bi-plus-circle"></i> Create New Swap
                </h2>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    {{ form|crispy }}
                    
                    <!-- Fee Breakdown -->
                    <div class="card mt-4 bg-light">
                        <div class="card-body">
                            <h6 class="card-title">Fee Breakdown</h6>
                            <div class="row">
                                <div class="col-6">
                                    <small>Platform Fee (0.15%):</small>
                                    <div class="fw-bold" id="platform-fee">MWK 0.00</div>
                                </div>
                                <div class="col-6">
                                    <small>Agent Fee (0.45%):</small>
                                    <div class="fw-bold" id="agent-fee">MWK 0.00</div>
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-6">
                                    <small>Total Fees (0.6%):</small>
                                    <div class="fw-bold text-danger" id="total-fees">MWK 0.00</div>
                                </div>
                                <div class="col-6">
                                    <small>You Receive:</small>
                                    <div class="fw-bold text-success" id="net-amount">MWK 0.00</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <button type="submit" class="btn btn-primary btn-lg w-100">
                            <i class="bi bi-send"></i> Send Swap Request
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const amountInput = document.querySelector('#id_amount');
    const platformFee = document.querySelector('#platform-fee');
    const agentFee = document.querySelector('#agent-fee');
    const totalFees = document.querySelector('#total-fees');
    const netAmount = document.querySelector('#net-amount');

    function calculateFees() {
        const amount = parseFloat(amountInput.value) || 0;
        const totalFee = amount * 0.006;
        const platformFeeAmount = totalFee * 0.25;
        const agentFeeAmount = totalFee * 0.75;
        const net = amount - totalFee;

        platformFee.textContent = `MWK ${platformFeeAmount.toFixed(2)}`;
        agentFee.textContent = `MWK ${agentFeeAmount.toFixed(2)}`;
        totalFees.textContent = `MWK ${totalFee.toFixed(2)}`;
        netAmount.textContent = `MWK ${net.toFixed(2)}`;
    }

    amountInput.addEventListener('input', calculateFees);
    calculateFees(); // Initial calculation
});
</script>
{% endblock %}